using System;
using System.Security.Permissions;
using Microsoft.Win32.SafeHandles;

namespace MalwareScanner.Scanners.Amsi
{
	[SecurityPermission(SecurityAction.Demand, UnmanagedCode = true)]
	public sealed class AmsiContextSafeHandle : SafeHandleZeroOrMinusOneIsInvalid
	{
		// Create a SafeHandle, informing the base class that this SafeHandle instance "owns" the handle,
		// and therefore SafeHandle should call our ReleaseHandle method when the SafeHandle is no longer in use.
		public AmsiContextSafeHandle() : base(true)
		{
		}

		protected override bool ReleaseHandle()
		{
			AmsiNativeMethods.AmsiUninitialize(this.handle);

			return true;
		}
	}
}
